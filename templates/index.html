<!DOCTYPE html>
<html>
<head>
    <title>Suggestion Box</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
</head>
<body>
    <h1>Suggestion Box</h1>

    <form method="POST" action="/suggest">
        <label for="suggestion">New Suggestion:</label>
        <input type="text" id="suggestion" name="suggestion" required>
        <button type="submit">Submit</button>
    </form>

    <h2>Suggestions:</h2>
    <ul>
    {% for suggestion in suggestions %}
        <li>
            {{ suggestion.text }} 
            (Upvotes: <span id="upvote-count-{{ loop.index0 }}">{{ suggestion.upvotes }}</span>, 
            Downvotes: <span id="downvote-count-{{ loop.index0 }}">{{ suggestion.downvotes }}</span>)
            <button class="upvote-btn" data-index="{{ loop.index0 }}">üëç</button> 
            <button class="downvote-btn" data-index="{{ loop.index0 }}">üëé</button>
        </li>
    {% endfor %}
    </ul>
    <script>
        $('.upvote-btn').click(function() {
            var index = $(this).data('index');
            $.ajax({
                url: '/upvote/' + index,
                type: 'POST',
                success: function(response) {
                    if (response.status === 'success') {
                        $('#upvote-count-' + index).text(parseInt($('#upvote-count-' + index).text()) + 1);
                    } else if (response.status === 'already_voted') {
                        alert("You have already voted on this suggestion.");
                    }
                }
            });
        });

        $('.downvote-btn').click(function() {
            var index = $(this).data('index');
            $.ajax({
                url: '/downvote/' + index,
                type: 'POST',
                success: function(response) {
                    if (response.status === 'success') {
                        $('#downvote-count-' + index).text(parseInt($('#downvote-count-' + index).text()) + 1);
                    } else if (response.status === 'already_voted') {
                        alert("You have already voted on this suggestion.");
                    }
                }
            });
        });
    </script>
</body>
</html>